<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>ì§ì¶œí‡´ ì•Œë¦¼ êµ¬ë… - inzisoft</title>
  <meta name="theme-color" content="#ffffff" />
  <link rel="manifest" href="/manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="apple-touch-icon" href="./images/icon.png" />
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 1.5rem;
      background-color: #f7f9fc;
      color: #333;
    }

    h1 {
      font-size: 1.8rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    .subscribe-box {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 2rem;
    }

    button {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      background-color: #4a90e2;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 1rem;
    }

    button:hover {
      background-color: #357ab7;
    }

    .info-text {
      text-align: center;
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .guide-section {
      background-color: #ffffff;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .toggle-header {
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1rem;
      margin-bottom: 1rem;
      background-color: #eef4ff;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
      transition: background-color 0.3s;
    }

    .toggle-header:hover {
      background-color: #d8e9ff;
    }

    .toggle-icon {
      margin-left: 0.5rem;
      font-size: 1.1rem;
    }

    .guide-content {
      display: none;
      transition: max-height 0.3s ease;
    }

    .guide-content.open {
      display: block;
    }

    .step {
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .step img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }

    .step:nth-child(2) img {
      width: 90%;
      max-width: 400px; /* 2ë²ˆ ì´ë¯¸ì§€ í™•ëŒ€ */
    }

    .step span {
      display: block;
      font-size: 0.9rem;
      color: #555;
    }

    .usage-tip {
      background-color: #fff4e5;
      color: #a65f00;
      border-left: 5px solid #ffa726;
      padding: 0.75rem 1rem;
      margin-top: 1.5rem;
      border-radius: 8px;
      font-size: 0.9rem;
      line-height: 1.5;
    }

  </style>
</head>
<body>
  <h1>ì§ì¶œí‡´ ì•Œë¦¼ êµ¬ë…</h1>

  <div class="subscribe-box">
    <button id="btn-subscribe" onclick="subscribe()" style="display: none;">Subscribe</button>
    <button id="btn-unsubscribe" onclick="unsubscribe()" style="display: none;background-color:crimson">Subscribed</button>
    <div class="info-text">
      <p>â° ì˜¤ì „ 09:30, 09:55ì— <strong>ì§ì¶œ</strong> ì•Œë¦¼ì´ ë°œì†¡ë©ë‹ˆë‹¤.</p>
      <p>â° ì˜¤í›„ 17:00ì— <strong>ì§í‡´</strong> ì•Œë¦¼ì´ ë°œì†¡ë©ë‹ˆë‹¤.</p>
    </div>
    <div class="usage-tip">
      âš ï¸ì‚¬ìš©ë²•<br>
      <strong>ì•ˆë“œë¡œì´ë“œ:</strong> í‘¸ì‹œ ì•Œë¦¼ì„ ì‚¬ìš©í•˜ë ¤ë©´ <strong>Chrome</strong>, <strong>ì‚¼ì„± ì¸í„°ë„·</strong>, <strong>ì—£ì§€</strong>, <strong>íŒŒì´ì–´í­ìŠ¤</strong>ë¡œ ì—´ì–´ì£¼ì„¸ìš”.
      <br><strong>ì• í”Œ:</strong> ì•„ë˜ ì„¤ëª…ì„ ì°¸ê³ í•˜ì„¸ìš”.
    </div>
    
  </div>

  <div class="guide-section">
    <div class="toggle-header" onclick="toggleGuide()">
      ğŸ“Œ ì‚¬ë²ˆ í™•ì¸ ë°©ë²•
      <span class="toggle-icon" id="toggleIcon">â–¼</span>
    </div>

    <div class="guide-content" id="guideContent">
      <div class="step">
        <img src="./images/guide-web-01.png" alt="1ë‹¨ê³„">
        <span>TBMSì— ë¡œê·¸ì¸ í›„ ìš°ì¸¡ ìƒë‹¨ì˜ ì´ë¦„ì„ í´ë¦­í•©ë‹ˆë‹¤.</span>
      </div>
      <div class="step">
        <img src="./images/guide-web-02.png" alt="2ë‹¨ê³„">
        <span>ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œ <strong>ê³„ì • ì •ë³´</strong>ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.</span>
      </div>
      <div class="step">
        <img src="./images/guide-web-03.png" alt="3ë‹¨ê³„">
        <span>ê³„ì • ì •ë³´ íŒì—…ì—ì„œ <strong>ì‚¬ë²ˆ</strong>ì„ í™•ì¸í•©ë‹ˆë‹¤.</span>
      </div>
    </div>

    <div class="toggle-header" onclick="toggleGuide2()">
      ğŸ“Œ ì•„ì´í°(IOS 16.4ì´ìƒ) ì‚¬ìš©ë°©ë²•
      <span class="toggle-icon" id="toggleIcon2">â–¼</span>
    </div>

    <div class="guide-content" id="guideContent2">
      <div class="step">
        <img src="./images/guide-ios-01.png" alt="1ë‹¨ê³„" style="max-width: 50%">
        <span><strong>safari</strong>ë¡œ í˜ì´ì§€ë¥¼ ì—° í›„ì— <strong>ê³µìœ  ë²„íŠ¼</strong>ì„ í´ë¦­í•©ë‹ˆë‹¤.</span>
      </div>
      <div class="step">
        <img src="./images/guide-ios-02.png" alt="2ë‹¨ê³„" style="max-width: 50%">
        <span><strong>í™ˆí™”ë©´ì— ì¶”ê°€</strong>ë¥¼ ì„ íƒí•©ë‹ˆë‹¤..</span>
      </div>
      <div class="step">
        <img src="./images/guide-ios-03.png" alt="3ë‹¨ê³„" style="max-width: 50%">
        <span><strong>ì¶”ê°€ ë²„íŠ¼</strong>ì„ í´ë¦­í•©ë‹ˆë‹¤.</span>
      </div>
      <div class="step">
        <img src="./images/guide-ios-04.png" alt="4ë‹¨ê³„" style="max-width: 50%">
        <span>í™ˆí™”ë©´ì— ìƒê¸´ ë°”ë¡œê°€ê¸°ë¡œ ì ‘ì†í•©ë‹ˆë‹¤.</span>
      </div>
    </div>
  </div>

  <script>
    const vapidPublicKey = 'BFSA_8aQ8Ib7U4MSsWiMHrlXB5cfa8h2QBhSC_70yzydT3w6WGLQyzy1PmPg9LERgqwhkdYE-wwPaRkFWGI8eng'; // ì„œë²„ì—ì„œ ìƒì„±í•œ ê³µê°œí‚¤
    const serverUrl = window.location.origin;

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(() => {
        console.log('Service Worker registered');
      });
    }

    navigator.serviceWorker.ready.then(registration => {
      return registration.pushManager.getSubscription();
    }).then(subscription => {
      if (subscription) {
        document.getElementById("btn-subscribe").style.display = "none";
        document.getElementById("btn-unsubscribe").style.display = "inline-block";
      } else {
        document.getElementById("btn-subscribe").style.display = "inline-block";
        document.getElementById("btn-unsubscribe").style.display = "none";
      }
    }).catch(err => {
      console.error("êµ¬ë… ì—¬ë¶€ í™•ì¸ ì‹¤íŒ¨:", err);
    });

    async function subscribe() {
      const registration = await navigator.serviceWorker.ready;

      const subscription = await registration.pushManager.subscribe({
        userVisibleOnly: true,
        applicationServerKey: urlBase64ToUint8Array(vapidPublicKey)
      });

      const key = prompt("ì‚¬ë²ˆì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: IZ250101)");
      if (key === null) return;
      
      await fetch(`${serverUrl}/push/subscribe`, {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'ngrok-skip-browser-warning': '69420'
        },
        body: JSON.stringify({ key, subscription })
      });

      alert('êµ¬ë… ì™„ë£Œ!');
    }

    function urlBase64ToUint8Array(base64String) {
      const padding = '='.repeat((4 - base64String.length % 4) % 4);
      const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
      const raw = atob(base64);
      return new Uint8Array([...raw].map(c => c.charCodeAt(0)));
    }

    function toggleGuide() {
      const content = document.getElementById("guideContent");
      const icon = document.getElementById("toggleIcon");
      const isOpen = content.classList.toggle("open");
      icon.textContent = isOpen ? "â–²" : "â–¼";
    }
    function toggleGuide2() {
      const content = document.getElementById("guideContent2");
      const icon = document.getElementById("toggleIcon2");
      const isOpen = content.classList.toggle("open");
      icon.textContent = isOpen ? "â–²" : "â–¼";
    }
  </script>
</body>
</html>